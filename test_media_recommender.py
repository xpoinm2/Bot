#!/usr/bin/env python3
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤.
"""

import asyncio
import os
from media_recommender import get_media_recommender

async def test_media_recommendations():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–∏—Å—Ç–µ–º—É —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π"""

    # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫–µ pastes
    test_library_path = "library/8412294171"
    os.makedirs(f"{test_library_path}/pastes", exist_ok=True)

    # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –ø–∞—Å—Ç—ã —Å –±–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏
    test_pastes = [
        ("–ø—Ä–∏–≤–µ—Ç_—Ä–∞–¥_–≤–∏–¥–µ—Ç—å.txt", "–ü—Ä–∏–≤–µ—Ç! –û—á–µ–Ω—å —Ä–∞–¥–∞ —Ç–µ–±—è –≤–∏–¥–µ—Ç—å! üòä –ö–∞–∫ —Ç–≤–æ–∏ –¥–µ–ª–∞?"),
        ("–æ—Ç–ª–∏—á–Ω–æ_—Å–µ–≥–æ–¥–Ω—è.txt", "–°–µ–≥–æ–¥–Ω—è —É –º–µ–Ω—è –≤—Å–µ –æ—Ç–ª–∏—á–Ω–æ! –ü–æ–ª–Ω–∞ —ç–Ω–µ—Ä–≥–∏–∏ –∏ —Ö–æ—Ä–æ—à–µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è!"),
        ("—Ä–∞–±–æ—Ç–∞—é_–≤_–æ—Ñ–∏—Å–µ.txt", "–Ø —Ä–∞–±–æ—Ç–∞—é –≤ –æ—Ñ–∏—Å–µ, –∑–∞–Ω–∏–º–∞—é—Å—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º–∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏. –ê —Ç—ã —á–µ–º –∑–∞–Ω–∏–º–∞–µ—à—å—Å—è?"),
        ("–ø–æ–∂–∞–ª—É–π—Å—Ç–∞_–≤—Å–µ–≥–¥–∞.txt", "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞! –í—Å–µ–≥–¥–∞ —Ä–∞–¥–∞ –ø–æ–º–æ—á—å! –¢—ã —Ç–∞–∫–æ–π —Ö–æ—Ä–æ—à–∏–π —á–µ–ª–æ–≤–µ–∫!"),
        ("—Ä–∞—Å—Å–∫–∞–∂–∏_–æ_—Å–µ–±–µ.txt", "–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ! –ì–¥–µ —Ç—ã –∂–∏–≤–µ—à—å? –ß–µ–º –∑–∞–Ω–∏–º–∞–µ—à—å—Å—è?"),
        ("–ø–æ–Ω–∏–º–∞—é_—É—Å—Ç–∞–ª.txt", "–ü–æ–Ω–∏–º–∞—é, –∏–Ω–æ–≥–¥–∞ —Ç–∞–∫ —É—Å—Ç–∞–µ—à—å... –ú–æ–∂–µ—Ç —á–∞—é –ø–æ–ø—å–µ–º? ‚òï"),
        ("–¥–∞_–≥–æ—Ç–æ–≤–ª—é_—Å_–ª—é–±–æ–≤—å—é.txt", "–î–∞, –æ—á–µ–Ω—å –ª—é–±–ª—é –≥–æ—Ç–æ–≤–∏—Ç—å! –û—Å–æ–±–µ–Ω–Ω–æ –ø–∞—Å—Ç—É –∏ —Å–∞–ª–∞—Ç—ã. –ê —Ç—ã –≥–æ—Ç–æ–≤–∏—à—å?"),
        ("—Ö–æ—Ä–æ—à–µ–≥–æ_–¥–Ω—è_—Ç–µ–±–µ.txt", "–ò —Ç–µ–±–µ —Ö–æ—Ä–æ—à–µ–≥–æ –¥–Ω—è! –ü–∏—à–∏, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è! üëã"),
    ]

    for filename, content in test_pastes:
        with open(f"{test_library_path}/pastes/{filename}", 'w', encoding='utf-8') as f:
            f.write(content)

    # –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
    recommender = get_media_recommender(8412294171)

    test_messages = [
        "–ø—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?",  # –í–æ–ø—Ä–æ—Å - –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç—ã, –∞ –Ω–µ –≤–æ–ø—Ä–æ—Å—ã
        "—Ä–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ",    # –ü—Ä–æ—Å—å–±–∞ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å - –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—Å–∫–∞–∑
        "—Å–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–º–æ—â—å",  # –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å - –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –Ω–∞ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å
        "—è —Å–µ–≥–æ–¥–Ω—è —É—Å—Ç–∞–ª",    # –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ - –º–æ–∂–µ–º –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Å–æ—á—É–≤—Å—Ç–≤–∏–µ –∏–ª–∏ –≤–æ–ø—Ä–æ—Å
        "—Ç—ã —É–º–µ–µ—à—å –≥–æ—Ç–æ–≤–∏—Ç—å?", # –í–æ–ø—Ä–æ—Å - –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç
        "—Ö–æ—Ä–æ—à–µ–≥–æ –¥–Ω—è!",      # –ü—Ä–æ—â–∞–Ω–∏–µ - –º–æ–∂–µ–º –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –æ—Ç–≤–µ—Ç–Ω–æ–µ –ø—Ä–æ—â–∞–Ω–∏–µ
    ]

    print("TEST: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤")
    print("=" * 60)

    for message in test_messages:
        print(f"\nMESSAGE: '{message}'")
        recommendations = await recommender.recommend_media(message, api_key=os.getenv("OPENAI_API_KEY"))

        if recommendations:
            print("RECOMMENDATIONS:")
            for i, rec in enumerate(recommendations, 1):
                print(f"  {i}. {rec.filename} (—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: {rec.relevance_score:.1%})")
                print(f"     –¢–∏–ø: {rec.file_type}")
                print(f"     –ü—Ä–∏—á–∏–Ω–∞: {rec.reason}")
        else:
            print("NO SUITABLE FILES FOUND")

        print("-" * 40)

if __name__ == "__main__":
    asyncio.run(test_media_recommendations())
