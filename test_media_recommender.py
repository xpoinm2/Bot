#!/usr/bin/env python3
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤.
"""

import asyncio
import os
from media_recommender import get_media_recommender

async def test_media_recommendations():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–∏—Å—Ç–µ–º—É —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π"""

    # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫–µ pastes
    test_library_path = "library/8412294171"
    os.makedirs(f"{test_library_path}/pastes", exist_ok=True)

    # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –ø–∞—Å—Ç—ã
    test_pastes = [
        ("–ø—Ä–∏–≤–µ—Ç_–¥–æ–±—Ä—ã–π_–¥–µ–Ω—å.txt", "–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞? –†–∞–¥ —Ç–µ–±—è –≤–∏–¥–µ—Ç—å! üòä"),
        ("–æ_—Å–µ–±–µ_—Ä–∞—Å—Å–∫–∞–∑.txt", "–Ø —Ä–∞–±–æ—Ç–∞—é –≤ IT, –ª—é–±–ª—é –ø—É—Ç–µ—à–µ—Å—Ç–≤–æ–≤–∞—Ç—å –∏ –≥–æ—Ç–æ–≤–∏—Ç—å. –ê —Ç—ã —á–µ–º –∑–∞–Ω–∏–º–∞–µ—à—å—Å—è?"),
        ("—Å–ø–∞—Å–∏–±–æ_–ø–æ–º–æ—â—å.txt", "–°–ø–∞—Å–∏–±–æ –±–æ–ª—å—à–æ–µ –∑–∞ –ø–æ–º–æ—â—å! –¢—ã –Ω–∞—Å—Ç–æ—è—â–∏–π –¥—Ä—É–≥! üôè"),
        ("–∫–∞–∫_–¥–µ–Ω—å_–ø—Ä–æ—à–µ–ª.txt", "–†–∞—Å—Å–∫–∞–∂–∏, –∫–∞–∫ —É —Ç–µ–±—è –ø—Ä–æ—à–µ–ª –¥–µ–Ω—å? –ß—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–≥–æ —Å–ª—É—á–∏–ª–æ—Å—å?"),
        ("–ª—é–±–ª—é_–≥–æ—Ç–æ–≤–∏—Ç—å.txt", "–Ø –æ—á–µ–Ω—å –ª—é–±–ª—é –≥–æ—Ç–æ–≤–∏—Ç—å! –û—Å–æ–±–µ–Ω–Ω–æ –∏—Ç–∞–ª—å—è–Ω—Å–∫—É—é –∫—É—Ö–Ω—é. –ê —Ç—ã —É–º–µ–µ—à—å –≥–æ—Ç–æ–≤–∏—Ç—å?")
    ]

    for filename, content in test_pastes:
        with open(f"{test_library_path}/pastes/{filename}", 'w', encoding='utf-8') as f:
            f.write(content)

    # –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
    recommender = get_media_recommender(8412294171)

    test_messages = [
        "–ø—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?",
        "—Ä–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ",
        "—Å–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–º–æ—â—å",
        "–∫–∞–∫ –ø—Ä–æ—à–µ–ª –¥–µ–Ω—å?",
        "—Ç—ã —É–º–µ–µ—à—å –≥–æ—Ç–æ–≤–∏—Ç—å?",
        "—á—Ç–æ —Ç—ã –ª—é–±–∏—à—å –¥–µ–ª–∞—Ç—å?"
    ]

    print("üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤")
    print("=" * 60)

    for message in test_messages:
        print(f"\nüì® –í—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: '{message}'")
        recommendations = await recommender.recommend_media(message, api_key=os.getenv("OPENAI_API_KEY"))

        if recommendations:
            print("üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:")
            for i, rec in enumerate(recommendations, 1):
                print(f"  {i}. {rec.filename} (—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: {rec.relevance_score:.1%})")
                print(f"     –¢–∏–ø: {rec.file_type}")
                print(f"     –ü—Ä–∏—á–∏–Ω–∞: {rec.reason}")
        else:
            print("‚ùå –ü–æ–¥—Ö–æ–¥—è—â–∏—Ö —Ñ–∞–π–ª–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ")

        print("-" * 40)

if __name__ == "__main__":
    asyncio.run(test_media_recommendations())
